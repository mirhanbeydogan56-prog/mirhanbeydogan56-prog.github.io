<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Esma Chat ‚Ä¢ Yeni Sistem</title>
<style>
    body {
        margin: 0;
        padding: 0;
        background: #0b0b13;
        font-family: "Poppins", sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        color: #fff;
    }

    /* ‚≠ê Esma temasƒ± parƒ±ltƒ±lar */
    body::before {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        background: url('https://i.imgur.com/3ZQ3ZQp.png');
        opacity: 0.12;
        pointer-events: none;
        z-index: 0;
    }

    #chatBox {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background: rgba(255,255,255,0.03);
        backdrop-filter: blur(4px);
        border-bottom: 2px solid #222;
        z-index: 2;
        display: flex;
        flex-direction: column;
    }

    /* üí¨ Mesaj balonlarƒ± */
    .msg {
        position: relative;
        max-width: 75%;
        padding: 10px 14px;
        margin: 8px 0;
        border-radius: 12px;
        display: inline-block;
        font-size: 15px;
        animation: pop 0.2s ease;
        word-break: break-word;
    }
    @keyframes pop {
        from { transform: scale(0.8); opacity: 0;} to { transform: scale(1); opacity: 1; }
    }

    .me {
        background: #6a5acd;
        align-self: flex-end;
        border-bottom-right-radius: 0;
        color: #021;
    }

    .other {
        background: #222;
        border-bottom-left-radius: 0;
        color: #fff;
    }

    #typing {
        font-size: 13px;
        opacity: 0.9;
        margin: 6px 12px 0 12px;
        color: #a0a0ff;
        padding: 6px 8px;
        display: none;
    }

    #controls {
        display: flex;
        padding: 10px;
        background: #151515;
        gap: 10px;
        z-index: 3;
    }

    #msgInput {
        flex: 1;
        padding: 12px;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        background: #222;
        color: #fff;
    }

    #sendBtn {
        padding: 12px 20px;
        border: none;
        background: #6a5acd;
        color: white;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
    }

    /* üì± Mobil optimize */
    @media (max-width: 600px) {
        #msgInput { font-size: 14px; }
        #sendBtn { font-size: 14px; padding: 10px 14px; }
        .msg { font-size: 14px; max-width: 85%; }
    }

    /* üí• B√ºy√ºk Kalp Patlama Efekti */
    .heart-burst {
        position: absolute;
        font-size: 40px;
        animation: burst 0.6s ease forwards;
        pointer-events: none;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
    }

    @keyframes burst {
        0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
        80% { transform: translate(-50%, -50%) scale(1.6); opacity: 1; }
        100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
    }
</style>
</head>
<body>

<!-- üîê ≈ûifre Giri≈ü Ekranƒ± -->
<div id="lockScreen" style="position:fixed; inset:0; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:9999;">
    <h2 style="color:white; font-size:26px; margin-bottom:20px;">Giri≈ü ≈ûifresi</h2>
    <input id="pinInput" type="password" placeholder="≈ûifre..." style="padding:12px; font-size:18px; border-radius:8px; border:none; text-align:center;">
    <button id="pinBtn" style="margin-top:15px; padding:10px 20px; font-size:18px; border:none; border-radius:8px; background:#6a5acd; color:white;">Giri≈ü</button>
    <p id="pinError" style="color:red; margin-top:10px; font-size:14px;"></p>
</div>

<div id="chatBox"></div>
<div id="typing">üíû Esma yazƒ±yor...</div>

<div id="controls">
    <input id="msgInput" placeholder="Mesaj yaz...">
    <button id="sendBtn">G√∂nder</button>
</div>

<script type="module">
    /* üî• Yeni Firebase Proje */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAiQnxZ3FzqNk8Tn69jQ4mfnyPvQ9jfNrc",
        authDomain: "newchat-66831.firebaseapp.com",
        databaseURL: "https://newchat-66831-default-rtdb.firebaseio.com",
        projectId: "newchat-66831",
        storageBucket: "newchat-66831.firebasestorage.app",
        messagingSenderId: "691479855616",
        appId: "1:691479855616:web:bbcfc226b2ca4bbdcb4ee5",
        measurementId: "G-TN28ETL3M3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const chatRef = ref(db, "messages");
    const typingRef = ref(db, "EsmaChatV2/typing");

    const input = document.getElementById("msgInput");
    const typingEl = document.getElementById("typing");
    const box = document.getElementById("chatBox");

    /* üîî Yazƒ±yor bildirimi */
    let typingTimeout;
    input.addEventListener("input", () => {
        set(typingRef, "yazƒ±yor...");
        clearTimeout(typingTimeout);
        typingTimeout = setTimeout(() => set(typingRef, ""), 1500);
    });

    onValue(typingRef, snap => {
        const v = snap.val() || "";
        typingEl.style.display = v ? 'block' : 'none';
        typingEl.textContent = v;
    });

    /* üí¨ Mesaj g√∂nderme */
    function sendMsg() {
        const text = input.value.trim();
        if (!text) return;
        push(chatRef, { text, sender: currentUser, ts: Date.now() });
        input.value = "";
        set(typingRef, "");
    }

    document.getElementById("sendBtn").addEventListener("click", sendMsg);

    /* üìå Mesajlarƒ± okuma */
    onValue(chatRef, snap => {
        const data = snap.val();
        box.innerHTML = "";

        if (!data) return;
        const arr = Object.entries(data).sort((a,b)=> a[1].ts - b[1].ts);

        arr.forEach(([k,v]) => {
            const div = document.createElement("div");
            div.className = "msg " + (v.sender === "me" ? "me" : "other");
            div.textContent = v.text;

            // Tek tƒ±klama: k√º√ß√ºk kalp ekle
            div.addEventListener('click', () => {
                div.textContent += ' üíû';
            });

            // üí• √áift tƒ±klayƒ±nca b√ºy√ºk kalp patlamasƒ±
            div.addEventListener('dblclick', () => {
                const burst = document.createElement('div');
                burst.className = 'heart-burst';
                burst.textContent = 'üíñ';
                div.appendChild(burst);
                setTimeout(() => burst.remove(), 600);
            });

            box.appendChild(div);
        });

        box.scrollTop = box.scrollHeight;
    });
</script>

<script>
// üîê ≈ûifre sistemi ‚Äï PIN: esma5685 / mirhan5685
const lockScreen = document.getElementById("lockScreen");
const pinInput = document.getElementById("pinInput");
const pinBtn = document.getElementById("pinBtn");
const pinError = document.getElementById("pinError");

let currentUser = "other"; // varsayƒ±lan

pinBtn.addEventListener("click", () => {
    if (pinInput.value === "esma5685") {
        currentUser = "left"; // soldaki kullanƒ±cƒ±
        lockScreen.style.display = "none";
    } else if (pinInput.value === "mirhan5685") {
        currentUser = "right"; // saƒüdaki kullanƒ±cƒ±
        lockScreen.style.display = "none";
    } else {
        pinError.textContent = "Yanlƒ±≈ü ≈üifre!";
    }
});("click", () => {
    if (pinInput.value === "esma5685") {
        lockScreen.style.display = "none";
    } else {
        pinError.textContent = "Yanlƒ±≈ü ≈üifre!";
    }
});
</script>

</body>
</html>
