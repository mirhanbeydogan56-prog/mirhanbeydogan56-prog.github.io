<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Durum Takip</title>
  <style>
    body{
      font-family:Inter,system-ui;
      margin:0;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:linear-gradient(135deg,#0f172a,#1e293b,#334155);
      background-size:400% 400%;
      animation:bgmove 12s ease infinite;
    }
    @keyframes bgmove{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .card{
      width:360px;
      background:rgba(255,255,255,0.12);
      padding:20px;
      border-radius:16px;
      backdrop-filter:blur(12px);
      box-shadow:0 8px 25px rgba(0,0,0,0.3);
      color:white;
    }
    h1{text-align:center;margin-bottom:14px;font-size:22px}
    input[type=password]{width:100%;padding:10px;font-size:15px;border-radius:8px;border:1px solid #ccc;margin-top:10px}
    button{width:100%;padding:10px;margin-top:12px;font-size:15px;border:0;border-radius:8px;background:#3b82f6;color:white;cursor:pointer}
    .status-box{margin-top:20px;font-size:20px;font-weight:600;text-align:center;padding:16px;border-radius:12px;background:rgba(255,255,255,0.15)}

    /* SLIDER TASARIMI */
    .slider-box{margin-top:20px;text-align:center}
    input[type=range]{width:100%;appearance:none;height:10px;border-radius:10px;background:linear-gradient(90deg,#ff7a7a,#ffb3b3);outline:none}
    input[type=range]::-webkit-slider-thumb{
      appearance:none;
      width:22px;height:22px;
      background:white;
      border-radius:50%;
      border:3px solid #ff7a7a;
    }
    #percent{font-size:28px;font-weight:700;margin-top:10px;color:#ffecec}
  </style>
</head>
<body>

<div class="card" id="loginCard">
  <h1>Durum Girişi</h1>
  <input id="pass" type="password" placeholder="Şifreyi girin" />
  <button id="loginBtn">Giriş Yap</button>
</div>

<div class="card" id="statusCard" style="display:none;">
  <h1 id="nameTitle"></h1>
  <div class="status-box" id="ownStatus"></div>

  <div class="slider-box">
    <h3>Kendi Durumun</h3>
    <input type="range" id="energySlider" min="0" max="100" value="50">
    <div id="percent">50%</div>
    <button id="saveBtn" style="background:#16a34a;margin-top:15px;">Kaydet</button>
  </div>

  <h3 style="margin-top:25px;" id="otherLabel">Diğer kişi</h3>
  <div class="status-box" id="otherStatus"></div>
</div>

<script>
  /* =============================
     JSONBIN AYARLARI
     ============================= */
  const JSONBIN_URL = "https://api.jsonbin.io/v3/b/693a5e3543b1c97be9e62340";
  const JSONBIN_KEY = "$2a$10$crw50rDviktX/qTN4XNj8eT9o6yJwPwv1wdlzXnu9YifkdKD9HxCG";

  /* ------------------
     Şifreler
  ------------------ */
  const PASSWORDS = { esma: "esma5685", mirhan: "mirhan5685" };

  let DATA = { esma: 50, mirhan: 50 };

  async function loadData(){
    try{
      const res = await fetch(JSONBIN_URL, {
        headers:{
          "X-Master-Key": JSONBIN_KEY,
          "X-Bin-Versioning": "false"
        }
      });
      const json = await res.json();
      DATA = json.record;
    }catch(err){ alert("Veri yüklenemedi"); }
  }

  async function saveData(){
    try{
      await fetch(JSONBIN_URL, {
        method:"PUT",
        headers:{
          "Content-Type": "application/json",
          "X-Master-Key": JSONBIN_KEY,
          "X-Bin-Versioning": "false"
        },
        body: JSON.stringify(DATA)
      });
    }catch(err){ alert("Kaydedilemedi"); }
  }

  /* ------------------
     Giriş İşlemi
  ------------------ */
  const loginCard = document.getElementById("loginCard");
  const statusCard = document.getElementById("statusCard");

  document.getElementById("loginBtn").addEventListener("click", async () => {
    const p = document.getElementById("pass").value.trim();
    let user = null;

    if (p === PASSWORDS.esma) user = "esma";
    if (p === PASSWORDS.mirhan) user = "mirhan";

    if (!user) return alert("Hatalı şifre!");

    await loadData();

    window.currentUser = user;
    showStatus(user);
  });

  function showStatus(user){
    loginCard.style.display = "none";
    statusCard.style.display = "block";

    const nameTitle = document.getElementById("nameTitle");
    const ownStatus = document.getElementById("ownStatus");
    const otherStatus = document.getElementById("otherStatus");
    const slider = document.getElementById("energySlider");
    const percent = document.getElementById("percent");

    if(user === "esma"){ 
      document.getElementById("otherLabel").textContent = "mirooo";
      nameTitle.textContent = "Esma'nın Durumu";
      slider.value = DATA.esma;
      percent.textContent = slider.value + "%";
      ownStatus.textContent = slider.value + "% enerji";
      otherStatus.textContent = DATA.mirhan + "% enerji";
    }

    if(user === "mirhan"){ 
      document.getElementById("otherLabel").textContent = "esoo";
      nameTitle.textContent = "Mirhan'ın Durumu";
      slider.value = DATA.mirhan;
      percent.textContent = slider.value + "%";
      ownStatus.textContent = slider.value + "% enerji";
      otherStatus.textContent = DATA.esma + "% enerji";
    }
  }

  document.getElementById("energySlider").addEventListener("input", e =>{
    document.getElementById("percent").textContent = e.target.value + "%";
  });

  document.getElementById("saveBtn").addEventListener("click", async ()=>{
    const val = Number(document.getElementById("energySlider").value);
    const user = window.currentUser;

    if(user === "esma") DATA.esma = val;
    if(user === "mirhan") DATA.mirhan = val;

    await saveData();

    document.getElementById("ownStatus").textContent = val + "% enerji";
    alert("Durum buluta kaydedildi!");
  });
</script>

</body>
</html>
