<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Futbol Tahmin Oyunu — Sahte Para</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    body{font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#071029 0%, #07172a 100%);color:#e6eef6;margin:0;padding:24px}
    .wrap{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .wallet{background:var(--card);padding:12px;border-radius:12px;display:flex;gap:12px;align-items:center}
    .balance{font-weight:700;font-size:18px}
    .muted{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px}
    button{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:#042024;cursor:pointer}
    input[type=number], input[type=text]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:16px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:12px}
    .match{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:10px;margin-bottom:8px;background:rgba(255,255,255,0.01)}
    .teams{display:flex;align-items:center;gap:12px}
    .btn-small{padding:6px 8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
    .bets{max-height:420px;overflow:auto}
    .status-won{color:#a7f3d0}
    .status-lost{color:#fecaca}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    a{color:var(--accent)}
    @media(max-width:900px){.grid{grid-template-columns:1fr} .controls{flex-direction:column;align-items:flex-end}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Futbol Tahmin Oyunu (Sahte Para)</h1>
      <div class="wallet card">
        <div>
          <div class="muted">Bakiye</div>
          <div class="balance" id="balance">0 ₺</div>
        </div>
        <div style="margin-left:12px" class="controls">
          <input id="depositAmt" type="number" min="1" placeholder="Miktar" />
          <button id="depositBtn">Para Yükle (sahte)</button>
          <button id="resetBtn" title="LocalStorage sıfırla">Sıfırla</button>
        </div>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <select id="leagueSelect" style="padding:6px;border-radius:8px;background:var(--glass);color:inherit;border:1px solid rgba(255,255,255,0.04)">
            <option value="Soccer">Futbol (Tüm Ligler)</option>
            <option value="Basketball">Basketbol</option>
            <option value="Ice Hockey">Buz Hokeyi</option>
            <option value="American Football">Amerikan Futbolu</option>
          </select>
          <strong>Bugünün Maçları (Tüm Ligler)</strong>
          <div>
            <button id="refreshBtn" class="btn-small">Yenile</button>
            <button id="checkResultsBtn" class="btn-small">Sonuçları Kontrol Et</button>
          </div>
        </div>
        <div id="matches" aria-live="polite">Maçlar yükleniyor...</div>
        <p class="muted">Not: Gerçek maç verileri <em>TheSportsDB</em> API'sinden çekilmeye çalışılır. Eğer ağ engeli, CORS ya da API kısıtı olursa demo veriye döner.</p>
      </section>

      <aside class="card">
        <strong>Aktif Bahisler</strong>
        <div class="bets" id="betsList" style="margin-top:8px">Henüz bahis yok.</div>
        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />
        <strong>Geçmiş Bahisler</strong>
        <div id="history" style="margin-top:8px;max-height:200px;overflow:auto">Henüz yok.</div>
      </aside>
    </div>

    <footer>
      <div>Bu site sadece oyun amaçlıdır. Hiçbir gerçek para ya da bahis aracı değildir.</div>
      <div style="margin-top:6px">Sayfa çalışmıyorsa <a href="#" id="showDebug">hata günlüğünü göster</a>.</div>
      <pre id="debug" style="display:none;background:#021524;padding:10px;border-radius:8px;color:#87eaf2;overflow:auto;max-height:200px"></pre>
    </footer>
  </div>

<script>
const API_BASE = 'https://corsproxy.io/?https://www.thesportsdb.com/api/v1/json/1/eventsday.php';
const storageKey = 'ft_wallet_v1';
const betsKey = 'ft_bets_v1';

function dbg(msg){const el=document.getElementById('debug');el.style.display='block';el.textContent+=msg+"\n"}

function loadState(){
  const s = JSON.parse(localStorage.getItem(storageKey) || '{}');
  return {balance: s.balance||0};
}
function saveState(state){localStorage.setItem(storageKey, JSON.stringify(state));}

function loadBets(){return JSON.parse(localStorage.getItem(betsKey)||'[]');}
function saveBets(b){localStorage.setItem(betsKey, JSON.stringify(b));}

function formatCurrency(n){return Number(n).toLocaleString('tr-TR') + ' ₺'}

function renderBalance(){const s=loadState();document.getElementById('balance').textContent=formatCurrency(s.balance)}

function deposit(amount){const state=loadState();state.balance = Number(state.balance) + Number(amount);saveState(state);renderBalance();}

function resetAll(){if(!confirm('LocalStorage sıfırlansın mı?')) return;localStorage.removeItem(storageKey);localStorage.removeItem(betsKey);renderBalance();renderBets();document.getElementById('matches').innerHTML='';}

function fetchMatchesForToday(){
  const league = document.getElementById('leagueSelect').value;
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,'0');
  const dd = String(today.getDate()).padStart(2,'0');
  const url = `${API_BASE}?d=${yyyy}-${mm}-${dd}&s=${encodeURIComponent(league)}`;

  fetch(url).then(r=>r.json()).then(data=>{
    if(data && data.events){ renderMatches(data.events); }
    else renderMatches([]);
  }).catch(err=>{
    dbg('API hata: '+err);
    renderMatches([]);
  });
}

function demoMatches(){
  // fallback demo data with the same shape as TheSportsDB events
  return [
    {idEvent:'demo1', strEvent:'Galatasaray vs Fenerbahçe', strHomeTeam:'Galatasaray', strAwayTeam:'Fenerbahçe', dateEvent:'2025-12-11', strTime:'18:00:00', intHomeScore:null, intAwayScore:null},
    {idEvent:'demo2', strEvent:'Beşiktaş vs Trabzonspor', strHomeTeam:'Beşiktaş', strAwayTeam:'Trabzonspor', dateEvent:'2025-12-11', strTime:'20:30:00', intHomeScore:2, intAwayScore:1}
  ];
}

function renderMatches(events){
  const wrap = document.getElementById('matches');
  if(!events || events.length===0){wrap.innerHTML='<div class="muted">Bugün maç bulunamadı.</div>';return}
  wrap.innerHTML = '';
  events.forEach(ev=>{
    const m = document.createElement('div');m.className='match';
    const teams = document.createElement('div');teams.className='teams';
    const left = document.createElement('div');left.innerHTML = `<div style="font-weight:700">${ev.strHomeTeam}</div><div class="muted" style="font-size:12px">${ev.dateEvent} ${ev.strTime||''}</div>`;
    const vs = document.createElement('div');vs.innerHTML=`<div style="text-align:center;font-weight:700">vs</div>`;
    const right = document.createElement('div');right.innerHTML = `<div style="font-weight:700;text-align:right">${ev.strAwayTeam}</div>`;
    teams.appendChild(left);teams.appendChild(vs);teams.appendChild(right);
    m.appendChild(teams);

    const controls = document.createElement('div');
    const scoreText = (ev.intHomeScore!=null && ev.intAwayScore!=null) ? `${ev.intHomeScore} - ${ev.intAwayScore}` : '<span class="muted">Henüz</span>';
    const scoreEl = document.createElement('div');scoreEl.innerHTML = `<div style="font-size:13px;margin-bottom:6px">Sonuç: ${scoreText}</div>`;
    controls.appendChild(scoreEl);

    const betBtn = document.createElement('button');betBtn.className='btn-small';betBtn.textContent='Tahmin Yap';
    betBtn.onclick = ()=>openBetModal(ev);
    controls.appendChild(betBtn);

    m.appendChild(controls);
    wrap.appendChild(m);
  });
}

function openBetModal(match){
  const amt = prompt(`${match.strHomeTeam} - ${match.strAwayTeam}\nTahmininizi girin (Home / Draw / Away) ve tutarı örnek: Home,50`);
  if(!amt) return; const parts = amt.split(',').map(s=>s.trim()); if(parts.length!==2){alert('Format: Seçim,HedefTutar — örn: Home,50');return}
  const choice = parts[0]; const amount = Number(parts[1]); if(!['Home','Draw','Away'].includes(choice)){alert('Seçim Home, Draw veya Away olmalı.');return}
  if(!amount || amount<=0){alert('Geçerli miktar girin.');return}
  const state = loadState(); if(state.balance < amount){alert('Yetersiz bakiye');return}
  state.balance -= amount; saveState(state); renderBalance();
  const bets = loadBets(); bets.push({id:match.idEvent||match.idEvent, home:match.strHomeTeam, away:match.strAwayTeam, date:match.dateEvent, time:match.strTime||'', choice, amount, settled:false, result:null}); saveBets(bets); renderBets();
}

function renderBets(){
  const list = loadBets();
  const el = document.getElementById('betsList');
  const hist = document.getElementById('history');
  if(list.length===0){el.innerHTML='Henüz bahis yok.'; hist.innerHTML='Henüz yok.'; return}
  const active = list.filter(b=>!b.settled);
  const past = list.filter(b=>b.settled);
  el.innerHTML = '';
  active.forEach((b,idx)=>{
    const d = document.createElement('div');d.style.padding='8px';d.style.borderBottom='1px solid rgba(255,255,255,0.02)';
    d.innerHTML = `<div style="font-weight:700">${b.home} — ${b.away}</div><div class="muted">Tahmin: ${b.choice} • Tutar: ${formatCurrency(b.amount)} • Tarih: ${b.date} ${b.time}</div>`;
    el.appendChild(d);
  });
  hist.innerHTML='';
  past.forEach(b=>{
    const p = document.createElement('div');p.style.padding='8px';p.style.borderBottom='1px solid rgba(255,255,255,0.02)';
    const cls = b.result==='win' ? 'status-won' : 'status-lost';
    p.innerHTML = `<div style="font-weight:700">${b.home} — ${b.away}</div><div class="muted">Tahmin: ${b.choice} • Tutar: ${formatCurrency(b.amount)} • Sonuç: <span class="${cls}">${b.result.toUpperCase()}</span></div>`;
    hist.appendChild(p);
  });
}

function checkResults(){
  // Re-fetch today's matches and update bets where scores are present
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,'0');
  const dd = String(today.getDate()).padStart(2,'0');
  const dateStr = `${yyyy}-${mm}-${dd}`;
  const url = API_BASE + '?d=' + dateStr + '&s=Soccer';
  fetch(url).then(r=>r.json()).then(data=>{
    const events = (data && data.events) ? data.events : demoMatches();
    let bets = loadBets();
    let changed=false;
    bets = bets.map(b=>{
      const ev = events.find(e => (e.idEvent && e.idEvent==b.id) || (e.strEvent && (e.strEvent.includes(b.home) && e.strEvent.includes(b.away))));
      if(!ev) return b;
      if(ev.intHomeScore!=null && ev.intAwayScore!=null && !b.settled){
        const home = Number(ev.intHomeScore); const away = Number(ev.intAwayScore);
        let outcome = 'Draw'; if(home>away) outcome='Home'; else if(away>home) outcome='Away';
        if(outcome === b.choice){ b.result='win'; b.settled=true; // payout 2x
          const state = loadState(); state.balance += b.amount * 2; saveState(state); renderBalance();
        } else { b.result='lose'; b.settled=true; }
        changed=true;
      }
      return b;
    });
    if(changed){ saveBets(bets); renderBets(); alert('Bazı bahislerin sonuçları güncellendi.'); }
    else alert('Yeni sonuç bulunamadı (henüz maç tamamlanmamış veya API veri yok).');
  }).catch(err=>{dbg('checkResults hata: '+err); alert('API hatası — demo verisi kontrol edildi.');
    // try demo
    const events = demoMatches();
    // same logic
    let bets = loadBets(); let changed=false;
    bets = bets.map(b=>{
      const ev = events.find(e => (e.idEvent && e.idEvent==b.id) || (e.strEvent && (e.strEvent.includes(b.home) && e.strEvent.includes(b.away))));
      if(!ev) return b;
      if(ev.intHomeScore!=null && ev.intAwayScore!=null && !b.settled){
        const home = Number(ev.intHomeScore); const away = Number(ev.intAwayScore);
        let outcome = 'Draw'; if(home>away) outcome='Home'; else if(away>home) outcome='Away';
        if(outcome === b.choice){ b.result='win'; b.settled=true; const state = loadState(); state.balance += b.amount * 2; saveState(state); renderBalance(); } else { b.result='lose'; b.settled=true; }
        changed=true;
      }
      return b;
    });
    if(changed){ saveBets(bets); renderBets(); alert('Demo veriye göre bazı bahisler sonuçlandı.'); } else alert('Demo veriye göre sonuclar yok.');
  });
}

// init
renderBalance(); renderBets(); fetchMatchesForToday();

// events
document.getElementById('depositBtn').addEventListener('click', ()=>{
  const v = Number(document.getElementById('depositAmt').value);
  if(!v || v<=0) return alert('Geçerli miktar girin.'); deposit(v); document.getElementById('depositAmt').value='';
});
document.getElementById('resetBtn').addEventListener('click', resetAll);
document.getElementById('refreshBtn').addEventListener('click', fetchMatchesForToday);
document.getElementById('checkResultsBtn').addEventListener('click', checkResults);

document.getElementById('showDebug').addEventListener('click',(e)=>{e.preventDefault(); const d=document.getElementById('debug'); d.style.display = d.style.display==='none' ? 'block' : 'none';});

</script>
</body>
</html>
