<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DC Çarkı — D ve C</title>
  <style>
    :root{--size:320px;--bg:#0f172a;--card:#0b1220;--accent:#06b6d4}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071022 0%, #081226 100%);color:#e6eef8}
    .wrap{width:min(960px,95vw);display:grid;grid-template-columns:1fr 320px;gap:24px;align-items:start}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .preview{display:flex;align-items:center;justify-content:center;height:100%;padding:12px}

    /* the wheel */
    .wheel-holder{width:var(--size);height:calc(var(--size) + 120px);display:grid;place-items:center;overflow:visible;position:relative}
    svg{width:100%;height:100%;overflow:visible}
    .label{font-weight:700;fill:#071022;font-size:38px}

    /* controls */
    .controls{display:flex;flex-direction:column;gap:12px}
    .row{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);border:0;padding:10px 12px;border-radius:8px;color:#022;cursor:pointer;font-weight:600}
    .secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}

    /* chat */
    #messages{height:260px;overflow:auto;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);display:flex;flex-direction:column;gap:6px}
    .msg{padding:8px 10px;border-radius:12px;max-width:72%;word-wrap:break-word}
    .msg.me{margin-left:auto;background:linear-gradient(90deg,rgba(6,182,212,0.12),rgba(6,182,212,0.06))}
    .msg.them{margin-right:auto;background:rgba(255,255,255,0.03)}

    @media (max-width:920px){.wrap{grid-template-columns:1fr}} 
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="preview">
        <div class="wheel-holder">
          <div id="resultBadge" style="position:absolute;top:8px;left:50%;transform:translateX(-50%);background:#fff;color:#022;padding:6px 12px;border-radius:8px;font-weight:700;box-shadow:0 6px 16px rgba(2,6,23,0.35);z-index:20">Üstte: —</div>
          <svg viewBox="-160 -230 320 420" aria-label="DC çarkı örneği">
            <polygon id="arrow" points="0,-170 -20,-130 20,-130" fill="#ff4040" />
            <g id="wheel-group">
              <g id="rot">
                <path d="M0,0 L0,-150 A150,150 0 0,0 0,150 Z" fill="#ffd166" />
                <path d="M0,0 L0,-150 A150,150 0 0,1 0,150 Z" fill="#4cc9f0" />
                <text x="-65" y="15" class="label">D</text>
                <text x="35" y="15" class="label">C</text>
              </g>
              <circle cx="0" cy="0" r="25" fill="#071022" />
            </g>
          </svg>
        </div>
      </div>
    </div>

    <aside class="card controls">
      <h3>DC Çarkı Kontrolleri</h3>
      <div class="row"><button id="startBtn">Çevir</button></div>
      <footer>İstediğiniz gibi değiştirebilirsiniz.</footer>
    </aside>

    <div class="card" id="chatCard">
      <h3 style="margin-top:0">Sohbet (giriş gerekli)</h3>
      <div id="loginBox" style="display:block">
        <label style="display:block;margin-bottom:8px">Site parolası:</label>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="passInput" type="password" placeholder="Parola girin" style="flex:1;padding:8px;border-radius:6px;border:1px solid #233" />
          <button id="passBtn" style="padding:8px 10px;border-radius:6px;background:var(--accent);border:0;cursor:pointer;color:#022">Giriş</button>
        </div>
        <div id="passErr" style="color:#ff9999;margin-top:8px;display:none">Hatalı parola</div>
      </div>

      <div id="chatUI" style="display:none;flex-direction:column;gap:8px">
        <div id="messages"></div>
        <form id="msgForm" style="display:flex;gap:8px;margin-top:6px">
          <input id="msgInput" placeholder="Mesaj yazın..." style="flex:1;padding:8px;border-radius:6px;border:1px solid #233" />
          <button type="submit" style="padding:8px 12px;border-radius:6px;background:var(--accent);border:0;cursor:pointer;color:#022">Gönder</button>
        </form>
      </div>
    </div>

  </div>

  <script>
  // Wheel logic
  const rot = document.getElementById('rot');
  const startBtn = document.getElementById('startBtn');
  let spinning = false;
  let angle = 0;

  startBtn.addEventListener('click', ()=>{
    if(spinning) return;
    spinning = true;
    const finalSide = Math.random() < 0.5 ? 'D' : 'C';
    let targetAngle = finalSide === 'D' ? 0 : 180;
    targetAngle += 360*5 + Math.random()*60;
    const start = angle;
    const diff = (targetAngle - start);
    const duration = 3000;
    const startTime = performance.now();
    function animate(t){
      const p = Math.min((t-startTime)/duration,1);
      const ease = 1 - Math.pow(1-p,3);
      angle = start + diff * ease;
      rot.setAttribute('transform',`rotate(${angle})`);
      if(p<1) requestAnimationFrame(animate);
      else { angle = angle % 360; spinning=false;
        const badge = document.getElementById('resultBadge');
        if(badge){ badge.textContent = `Üstte: ${finalSide}`; badge.style.transform = 'translateX(-50%) scale(1.05)'; setTimeout(()=>{ if(badge) badge.style.transform='translateX(-50%)'; },200); }

        // Çark sonucu chat'e de yazılıyor
        const resultMessage = `Çark sonucu: ${finalSide}`;
        appendMessage({ text: resultMessage, sender: 'system' });
      }
    }
    requestAnimationFrame(animate);
  });
  </script>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
  // Simple demo users
  const PASS_ESMA = 'esma5685';
  const PASS_MIRHAN = 'mirhan5685';
  let currentUser = null;

  const passInput = document.getElementById('passInput');
  const passBtn = document.getElementById('passBtn');
  const passErr = document.getElementById('passErr');
  const loginBox = document.getElementById('loginBox');
  const chatUI = document.getElementById('chatUI');
  const messagesEl = document.getElementById('messages');
  const msgForm = document.getElementById('msgForm');
  const msgInput = document.getElementById('msgInput');

  passBtn.addEventListener('click', ()=>{
    const v = passInput.value || '';
    if(v === PASS_ESMA){ currentUser = 'esma'; }
    else if(v === PASS_MIRHAN){ currentUser = 'mirhan'; }

    if(currentUser){
      loginBox.style.display='none';
      chatUI.style.display='flex';
      initChat();
    } else {
      passErr.style.display='block';
    }
  });

  // Firebase config (from user)
  const firebaseConfig = {
    apiKey: "AIzaSyBsHcKaTIifxx8VhcJIkzVgp0Ywgej7NCA",
    authDomain: "dcchat-7fa9a.firebaseapp.com",
    databaseURL: "https://dcchat-7fa9a-default-rtdb.firebaseio.com",
    projectId: "dcchat-7fa9a",
    storageBucket: "dcchat-7fa9a.firebasestorage.app",
    messagingSenderId: "993124998740",
    appId: "1:993124998740:web:3819bca9b8bc5496a797c1",
    measurementId: "G-CLEGHY1L0H"
  };

  function initChat(){
    if(window._chatInited) return;
    window._chatInited = true;

    // initialize firebase safely (compat may not expose firebase.apps())
    try{
      // if an app already exists, firebase.app() will return it; otherwise it throws
      try{ firebase.app(); }
      catch(e){ firebase.initializeApp(firebaseConfig); }
    }catch(e){ console.error('Firebase init failed', e); return; }

    const db = firebase.database();
    const msgsRef = db.ref('messages');

    // listen for new messages
    msgsRef.limitToLast(100).on('child_added', snap => {
      const d = snap.val();
      if(!d) return;
      appendMessage(d);
    });

    // submit message
    msgForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const txt = msgInput.value.trim();
      if(!txt) return;
      try{
        await msgsRef.push({ text: txt, ts: Date.now(), sender: currentUser });
        msgInput.value = '';
      }catch(err){
        console.error('DB write error', err);
        alert('Mesaj gönderilemedi. Konsolu kontrol edin.');
      }
    });
  }

  function appendMessage(d){
    const el = document.createElement('div');
    el.className = 'msg';
    el.textContent = d.text || '';
    el.style.maxWidth = '70%';
    if(currentUser && d.sender === currentUser){
      el.classList.add('me');
    } else {
      el.classList.add('them');
    }
    messagesEl.appendChild(el);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }
  </script>
</body>
</html>
