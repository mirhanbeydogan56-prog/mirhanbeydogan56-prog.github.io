<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Durum</title>
<style>
    body {
        background:#0f1b2d;
        font-family: Arial, sans-serif;
        color:white;
        display:flex;
        justify-content:center;
        padding-top:40px;
    }
    .card {
        background:#1c283a;
        padding:30px;
        border-radius:15px;
        width:350px;
        text-align:center;
        box-shadow:0 0 20px rgba(0,0,0,0.4);
    }
    input, select {
        width:100%;
        padding:12px;
        border:none;
        border-radius:10px;
        margin:8px 0;
        background:#3b475a;
        color:white;
        font-size:16px;
    }
    button {
        width:100%;
        padding:12px;
        margin-top:12px;
        border:none;
        border-radius:10px;
        background:#22c55e;
        color:white;
        font-size:18px;
        cursor:pointer;
        font-weight:bold;
    }
    button:hover { background:#1faa4d; }

    .slider {
        width:100%;
        margin-top:10px;
    }
    .percent {
        font-size:28px;
        margin-top:10px;
        font-weight:bold;
    }

    .nameLabel {
        margin-top:20px;
        font-size:18px;
        font-weight:bold;
    }
</style>
</head>
<body>

<div class="card">

    <h2 id="panelBaslik">Durum Paneli</h2>

    <input id="sifre" placeholder="Şifreyi Gir">
    <button onclick="giris()">Giriş Yap</button>

    <div id="panel" style="display:none;">
        <div class="nameLabel" id="isimLabel"></div>

        <h3>Kendi Durumun</h3>
        <input type="range" id="durumSlider" class="slider" min="0" max="100" value="50"
               oninput="yuzde.innerText = durumSlider.value + '%'">
        <div id="yuzde" class="percent">50%</div>

        <button onclick="kaydet()">Kaydet</button>

        <br><br>
        <div id="digerIsim" class="nameLabel"></div>
        <div id="digerDurum" class="percent">—</div>
    </div>

</div>

<script>
const BIN_ID = "693a5e3543b1c97be9e62340";
const API_URL = "https://api.jsonbin.io/v3/b/" + BIN_ID;
const API_KEY = "";  // Public bin ise boş bırak

let benimIsmim = "";
let digerIsim = "";

// ------------------------- GİRİŞ -------------------------
function giris() {
    const sifre = document.getElementById("sifre").value;

    if (sifre === "mirhan") {
        benimIsmim = "mirhan";
        digerIsim = "esoo";

        document.getElementById("panelBaslik").innerText = "Mirhan'ın Durumu";
    }
    else if (sifre === "esman") {
        benimIsmim = "esoo";
        digerIsim = "mirooo";

        document.getElementById("panelBaslik").innerText = "Esman'ın Durumu";
    }
    else {
        alert("Hatalı şifre!");
        return;
    }

    document.getElementById("panel").style.display = "block";
    document.getElementById("isimLabel").innerText = benimIsmim;
    document.getElementById("digerIsim").innerText = digerIsim;

    veriGetir();
}

// ------------------------- KAYDET -------------------------
async function kaydet() {
    let durum = document.getElementById("durumSlider").value;

    let data = {};
    data[benimIsmim] = durum;

    // önce mevcut veriyi çek
    let mevcut = await fetch(API_URL).then(r => r.json());
    mevcut.record[benimIsmim] = durum;

    await fetch(API_URL, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(mevcut.record)
    });

    alert("Kaydedildi!");
    veriGetir();
}

// ------------------------- VERİ GETİR -------------------------
async function veriGetir() {
    let veri = await fetch(API_URL).then(r => r.json());

    if (veri.record[digerIsmim] !== undefined) {
        document.getElementById("digerDurum").innerText =
            veri.record[digerIsmim] + "%";
    }
    else {
        document.getElementById("digerDurum").innerText = "—";
    }
}
</script>

</body>
</html>
