<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Watch Together + Live Chat</title>
<style>
body {
  font-family: Arial;
  display: flex;
  gap: 20px;
  padding: 20px;
  background: #f2f2f2;
}
#videoArea {
  width: 70%;
}
#chatBox {
  width: 30%;
  background: white;
  padding: 10px;
  border-radius: 10px;
  height: 90vh;
  display: flex;
  flex-direction: column;
}
#messages {
  flex: 1;
  overflow-y: auto;
  border: 1px solid #ccc;
  padding: 10px;
  margin-bottom: 10px;
}
input, button {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
}
</style>
</head>

<body>

<div id="videoArea">
  <h2>ðŸŽ¬ Birlikte YouTube Ä°zleme</h2>
  <input id="ytUrl" placeholder="YouTube linki yapÄ±ÅŸtÄ±r" />
  <button onclick="loadVideo()">Videoyu AÃ§</button>

  <iframe id="ytFrame" width="100%" height="500px" style="margin-top:10px;" allowfullscreen></iframe>
</div>

<div id="chatBox">
  <h2>ðŸ’¬ CanlÄ± Sohbet</h2>
  <div id="messages"></div>

  <input id="username" placeholder="Ä°smin" />
  <input id="message" placeholder="Mesaj yaz..." />
  <button onclick="sendMessage()">GÃ¶nder</button>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// ==========================
// ðŸ”¥ SENÄ°N FIREBASE CONFIG KODUN
// ==========================
const firebaseConfig = {
  apiKey: "AIzaSyC1P0hCILgqHHInXmb5nWmCNyBSv2L7TGE",
  authDomain: "erte-b64b8.firebaseapp.com",
  databaseURL: "https://erte-b64b8-default-rtdb.firebaseio.com",
  projectId: "erte-b64b8",
  storageBucket: "erte-b64b8.firebasestorage.app",
  messagingSenderId: "654545309522",
  appId: "1:654545309522:web:646d307cf51529c33fb48b",
  measurementId: "G-NEPG31DB06"
};
// ==========================

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Video SENKRONÄ°ZASYON yeri
const videoRef = ref(db, "video/url");

// Chat mesajlarÄ±
const chatRef = ref(db, "chat/messages");

// *********** YouTube Video YÃ¼kleme ***********
function loadVideo() {
  const url = document.getElementById("ytUrl").value;
  const videoId = url.split("v=")[1];
  if (!videoId) return alert("Link yanlÄ±ÅŸ!");

  set(videoRef, videoId); // herkese gÃ¶nder
}

// Video deÄŸiÅŸince iframe gÃ¼ncellenir
onValue(videoRef, (snapshot) => {
  const videoId = snapshot.val();
  if (videoId) {
    document.getElementById("ytFrame").src =
      "https://www.youtube.com/embed/" + videoId + "?autoplay=1";
  }
});

// *********** CHAT ***********
function sendMessage() {
  const user = document.getElementById("username").value;
  const msg = document.getElementById("message").value;

  if (!user || !msg) return;

  push(chatRef, {
    user,
    msg,
    time: Date.now()
  });

  document.getElementById("message").value = "";
}

onValue(chatRef, (snapshot) => {
  const messagesDiv = document.getElementById("messages");
  messagesDiv.innerHTML = "";

  snapshot.forEach((child) => {
    const data = child.val();
    messagesDiv.innerHTML += `<p><b>${data.user}:</b> ${data.msg}</p>`;
  });

  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});
</script>

</body>
</html>
