<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Birlikte İzle + Sohbet</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #111;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        #videoSection {
            flex: 2;
            background: #000;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }
        #chatSection {
            flex: 1;
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            padding: 10px;
            border-left: 2px solid #333;
        }
        input, button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            border-radius: 5px;
            border: none;
        }
        #messages {
            flex: 1;
            overflow-y: auto;
            background: #000;
            padding: 10px;
            border-radius: 5px;
        }
        iframe {
            width: 100%;
            height: 80%;
            border: none;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="videoSection">
        <h2>YouTube İzleme</h2>
        <input id="videoInput" placeholder="YouTube Video ID gir (örn: dQw4w9WgXcQ)">
        <button onclick="changeVideo()">Videoyu Aç</button>
        <iframe id="ytPlayer" src="https://www.youtube.com/embed/" allowfullscreen></iframe>
    </div>

    <div id="chatSection">
        <h2>Sohbet</h2>
        <div id="messages"></div>
        <input id="msgInput" placeholder="Mesaj yaz...">
        <button onclick="sendMessage()">Gönder</button>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC1P0hCILgqHHInXmb5nWmCNyBSv2L7TGE",
            authDomain: "erte-b64b8.firebaseapp.com",
            databaseURL: "https://erte-b64b8-default-rtdb.firebaseio.com",
            projectId: "erte-b64b8",
            storageBucket: "erte-b64b8.firebasestorage.app",
            messagingSenderId: "654545309522",
            appId: "1:654545309522:web:646d307cf51529c33fb48b",
            measurementId: "G-NEPG31DB06"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const videoRef = ref(db, "currentVideo");
        const chatRef = ref(db, "chatMessages");

        // Video izleme senkronizasyonu
        function changeVideo() {
            const videoID = document.getElementById("videoInput").value;
            if(videoID.trim() === "") return;
            set(videoRef, videoID);
        }

        onValue(videoRef, (snapshot) => {
            const videoID = snapshot.val();
            if(videoID) {
                document.getElementById("ytPlayer").src = `https://www.youtube.com/embed/${videoID}`;
            }
        });

        // Sohbet sistemi
        function sendMessage() {
            const msg = document.getElementById("msgInput").value;
            if(msg.trim() === "") return;
            push(chatRef, msg);
            document.getElementById("msgInput").value = "";
        }

        onValue(chatRef, (snapshot) => {
            const messages = snapshot.val();
            const msgBox = document.getElementById("messages");
            msgBox.innerHTML = "";
            for (let id in messages) {
                msgBox.innerHTML += `<p>${messages[id]}</p>`;
            }
            msgBox.scrollTop = msgBox.scrollHeight;
        });
    </script>
</body>
</html>
