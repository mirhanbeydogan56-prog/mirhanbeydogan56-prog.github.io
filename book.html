<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Depresyon Botu — Konuş</title>
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--accent:#7c5cff;--muted:#9aa4b2;--bubble:#0f1728}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#071021 0%, #0b1220 100%);color:#e6eef6;display:flex;align-items:center;justify-content:center;height:100vh;padding:20px}
    .app{width:100%;max-width:880px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(2,6,23,0.6);display:grid;grid-template-columns:320px 1fr}
    .sidebar{padding:18px;background:var(--card)}
    .main{display:flex;flex-direction:column}
    header{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#5ad7ff);display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{margin:0;font-size:18px}
    .lead{color:var(--muted);margin-top:6px;font-size:13px}

    .conversations{margin-top:14px;display:flex;flex-direction:column;gap:8px}
    .conv{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}

    .chat-area{display:flex;flex-direction:column;flex:1}
    .messages{flex:1;padding:18px;overflow:auto;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .msg{max-width:75%;padding:10px;border-radius:12px;margin-bottom:10px;line-height:1.35}
    .user{background:#1f2937;margin-left:auto;border-bottom-right-radius:4px}
    .bot{background:var(--bubble);border-bottom-left-radius:4px}
    .meta{font-size:12px;color:var(--muted);margin-bottom:8px}

    .composer{padding:12px;border-top:1px solid rgba(255,255,255,0.02);display:flex;gap:8px;align-items:center}
    textarea{flex:1;min-height:48px;max-height:140px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;resize:none}
    button.send{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;color:#051018;font-weight:700;cursor:pointer}
    .hint{font-size:13px;color:var(--muted);margin-top:10px}
    .danger{color:#ffb4b4;font-weight:700}

    .credits{font-size:13px;color:var(--muted);margin-top:12px}
    @media (max-width:820px){.app{grid-template-columns:1fr}.sidebar{display:none}}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Depresyon Botu">
    <aside class="sidebar">
      <header>
        <div class="logo">DB</div>
        <div>
          <h1>Depresyon Botu</h1>
          <div class="lead">Güvenli, dinleyici bir sohbet deneyimi. Bu bot profesyonel tedavi yerine geçmez.</div>
        </div>
      </header>

      <div class="conversations" id="conversations">
        <div class="conv" data-id="default">Yeni Sohbet</div>
      </div>

      <div class="credits">Yardım gerekirse: acil durumda yerel acil servisi arayın (Türkiye için 112). Profesyonel destek almak önemlidir.</div>
    </aside>

    <div class="main">
      <div class="messages" id="messages" aria-live="polite">
        <div class="meta">Depresyon Botu ile konuş. Ne hissettiğini anlat — ben dinliyorum.</div>
      </div>

      <div class="composer">
        <textarea id="input" placeholder="Derdini yaz... (gizli değilse duygularını açıkça yazabilirsin)"></textarea>
        <button class="send" id="send">Gönder</button>
      </div>
      <div style="padding:12px;background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent);">
        <div class="hint">Gizlilik: Bu sayfa sunucuya mesaj yollayacak şekilde yapılandırılabilir. Eğer OpenAI benzeri bir servis bağlarsan mesajların sunucuda işlenebilir.</div>
      </div>
    </div>
  </div>

  <script>
    // Güvenli uyarı: Tarayıcıda anahtar kullanmak üretimde önerilmez.
    let OPENAI_API_KEY = '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';

    function askApiKey(){
      try{
        const key = prompt('OpenAI API anahtarını gir (tarayıcıda geçici olarak kullanılacak). Üretimde backend kullanın.');
        if(key) OPENAI_API_KEY = key.trim();
      }catch(e){ console.warn('API key prompt blocked or unavailable'); }
    }

    // DOM element referansları
    let chatHistory = [];

const messagesEl = document.getElementById('messages');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');

    // İlk olarak kullanıcıdan API anahtarını iste (isteğe bağlı)
    askApiKey();

    function appendMessage(text, who='bot'){
      const el = document.createElement('div');
      el.className = 'msg ' + (who==='user' ? 'user' : 'bot');
      el.textContent = text;
      messagesEl.appendChild(el);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // Basit yerel fallback yanıtı (sunucu/anahtar yoksa)
    function localReply(userText){
      const lc = userText.toLowerCase();
      if(lc.includes('intihar')|| lc.includes('ölmek') || lc.includes('bitirmek')){
        return 'Bunları duyduğuma çok üzüldüm. Eğer kendine zarar verme düşüncen varsa lütfen hemen yerel acil servisi araman (Türkiye için 112) veya güvendiğin birini yanında çağırman önemlidir. İstersen seninle sakinleştirici nefes egzersizleri yapabilirim.';
      }
      if(lc.includes('yorgun') || lc.includes('umutsuz') || lc.includes('üzgün')){
        return 'Bu hisler gerçekten ağır geliyor olmalı. Bana ne zaman başladığını ya da seni en çok neyin etkilediğini anlatmak ister misin? Beraber adım adım düşünebiliriz.';
      }
      const replies = [
        'Bunu paylaşman cesaret ister, teşekkür ederim. Daha fazla anlatmak ister misin? Neler hissediyorsun?',
        'Anlıyorum — bu zor. Bir an için nefes alıp, küçük bir şeyi ifade etmeye çalışalım: şu an seni en çok ne yoruyor?',
        'Bana istediğin kadar detay ver. Seninle yargılamadan dinliyorum.'
      ];
      return replies[Math.floor(Math.random()*replies.length)];
    }

    async function send(){
      const text = input.value.trim();
      if(!text) return;
      // Kullanıcı mesajını göster
      appendMessage(text,'user');
      chatHistory.push({ role: 'user', text });
      input.value = '';

      // Bot yanıt placeholder
      appendMessage('...', 'bot');

      // Eğer açık API anahtarı yoksa fallback kullan
      if(!OPENAI_API_KEY){
        messagesEl.lastChild.textContent = localReply(text);
        return;
      }

      try{
        const resp = await fetch('https://api.openai.com/v1/chat/completions',{
          method:'POST',
          headers:{
            'Content-Type':'application/json',
            'Authorization':'Bearer ' + OPENAI_API_KEY
          },
          body: JSON.stringify({
            model: 'gpt-4o-mini',
            messages: chatHistory.map(m => ({ role: m.role, content: m.text })),
            max_tokens: 500
          })
        });

        if(!resp.ok){
          // Hata durumunda fallback göster
          console.warn('OpenAI API error', resp.status);
          messagesEl.lastChild.textContent = localReply(text);
          return;
        }

        const data = await resp.json();
        const reply = data.choices?.[0]?.message?.content || localReply(text);
        messagesEl.lastChild.textContent = reply;
        chatHistory.push({ role: 'assistant', text: reply });
      }catch(e){
        console.error('API request failed', e);
        messagesEl.lastChild.textContent = localReply(text);
      }
    }

    // Event listeners
    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); } });

    // Erişilebilirlik: focus
    try{ input.focus(); }catch(e){ /* ignore */ }
  </script>

  <!--
    NOT: Bu dosya tek başına çalışır. Tarayıcıda doğrudan OpenAI anahtarı kullanmak güvenli değildir.
    Üretimde kullanmak için anahtarı sunucuda tutup /api/chat gibi bir endpoint'e POST yapmanız gerekir.

    Örnek Node.js (Express) backend çıkarımı HTML içinde vardı; onu kullanarak güvenli backend kurabilirsiniz.
  -->
</body>
</html>

